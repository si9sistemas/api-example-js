const rootApi="https://api.si9sistemas.com.br/imobilsi9-api",staticTokenImonov=null,staticNameCookie=null,actionCore=null,clidados=null,generateTokenFn=async e=>{if(e&&console.log("REFRESH  ==>>>> ",e),window.sessionStorage.tokenLeadsImonov&&!e){let e=JSON.parse(window.sessionStorage.tokenLeadsImonov),o=new Date-new Date(e.dataTimeToken),t=Math.floor(o%864e5/36e5)+"h "+Math.round(o%864e5%36e5/6e4)+"m";return console.log("TEMPO DE VIDA TOKEN SESSION :"+t+" | "+o/1e3+" segundos"),(o/1e3>e.result.expires_in||o/1e3<-0)&&(window.sessionStorage.removeItem("tokenLeadsImonov"),e=await getSessionAuth(imonovLeads.staticTokenImonov),console.log("IF REFRESH TOKEN => ",e)),e.origem="storage",await e}{let o=e||imonovLeads.staticTokenImonov,t=new Headers;t.append("Authorization",o);let n={method:"POST",headers:t},s=rootApi+"/oauth/token?grant_type=password&username="+imonovLeads.staticUserSi9+"&password="+imonovLeads.staticPassSi9;const i=await fetch(s,n).then(handleErrors);return{result:await i,origem:"request"}}},sendContactFn=async e=>{let o=new Headers,t=e.result.token_type.toString()+" "+e.result.access_token.toString();o.append("Authorization",t),o.append("Content-Type","application/json");let n={method:"POST",headers:o,body:JSON.stringify(imonovLeads.clidados)};fetch(rootApi+"/lead",n).then(handleErrors).then((e=>{console.log("retornou interessado => ",e),e.id&&setCookieSessionFn(imonovLeads.staticNameCookie,e.id.toString());var o=imonovLeads.clidados.name?imonovLeads.clidados.name:imonovLeads.clidados.email;return document.getElementById("imonov-lead-msg").innerHTML='<div class="alert alert-success alert-dismissible fade show" role="alert">\n  <strong>Ol√°! '+o+'</strong> Seu contato foi enviado com sucesso!\n  <button type="button" onclick="closeMsgSuccessImoLead()" class="close" data-dismiss="alert" aria-label="Close">\n    <span aria-hidden="true">&times;</span>\n  </button>\n</div>',e})).catch((e=>{console.log(e)}))};async function handleErrors(e){if(console.log(e),401===e.status&&(window.sessionStorage.removeItem("tokenLeadsImonov"),await getSessionAuth(imonovLeads.staticTokenImonov),await getSessionAuth().then((e=>{sendContactFn(e)}))),!e.ok)throw Error(e.statusText);return e.json()}async function enviarContatoFn(e){imonovLeads.clidados=e?JSON.parse(JSON.stringify(e)):imonovLeads.clidados,await getSessionAuth().then((e=>{sendContactFn(e)}))}function setCookieSessionFn(e,o){console.log("SET COOKIE SESSION",e,o);let t="https:"!==location.protocol?"":";secure";t+="; isHttpOnly ; SameSite=Strict";let n=e.toString()+"="+o.toString()+";max-age=2592000"+t;document.cookie=n}function getCookieFn(e){let o=document.cookie;if(o){let t=o.split(";");for(let o=0;o<t.length;o++){let n=t[o].split("=");if(n[0]===e&&n[1]&&""!==n[1])return n[1]}}}function setFeedbackFn(e,o){if(window.sessionStorage.stgImmobileFeedbacks){let t=JSON.parse(window.sessionStorage.stgImmobileFeedbacks);console.log(t),t.push({observation:o,propertyId:e}),window.sessionStorage.stgImmobileFeedbacks=JSON.stringify(t)}else window.sessionStorage.stgImmobileFeedbacks=JSON.stringify([{observation:o,propertyId:e}])}function checkIfExistsFeedbackFn(e){let o=JSON.parse(window.sessionStorage.stgImmobileFeedbacks),t=0;for(let n=0;n<o.length;n++)o[n].propertyId===e&&t++;return t}async function getSessionAuth(e){let o=await generateTokenFn(e);return console.log("Token Recebido: ",o),"request"===o.origem&&(o.dataTimeToken=new Date,console.log("TOKEN SEND => ",o),window.sessionStorage.tokenLeadsImonov=JSON.stringify(o)),await o}const imonovLeads={rootApi:rootApi,staticTokenImonov:null,staticNameCookie:null,actionCore:null,clidados:null,generateToken:getSessionAuth,enviarContato:enviarContatoFn,sendContact:sendContactFn,setCookieSession:setCookieSessionFn,getCookie:getCookieFn,setFeedback:setFeedbackFn,checkIfExistsFeedback:checkIfExistsFeedbackFn};export{imonovLeads};